<html>
<head>
  <script>
    window.addEventListener("load", windowLoaded, false);
    function windowLoaded() {
      console.log("before chrome.tabs");
      chrome.tabs.getSelected(null, function(tab) {
        console.log("after chrome.tabs");
        var xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function (e) {
            document.getElementById("content").innerHTML = this.responseText;
        };
        xhr.open("GET", 'http://localhost:8080?q='+encodeURIComponent(tab.url), true);
        xhr.send();
      });
    }
  </script>
</head>
<body>
  <div id="content">loading</div>
 </body>
</html>
